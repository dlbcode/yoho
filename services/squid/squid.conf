# Basic Squid configuration for map tiles caching

# Port
http_port 3128

# Access control
acl localhost src 127.0.0.1/32
acl localnet src 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
acl docker src 172.0.0.0/8
acl SSL_ports port 443
acl Safe_ports port 80 443

# Only allow cachemgr access from localhost
http_access allow localhost manager
http_access deny manager

# Allow access from localnet
http_access allow localnet
http_access allow docker

# Deny requests to unsafe ports
http_access deny !Safe_ports

# Deny CONNECT to other than secure SSL ports
http_access deny CONNECT !SSL_ports

# Stadiamaps specific configuration
acl stadiamaps dstdomain .stadiamaps.com
cache allow stadiamaps

# Caching settings
cache_mem 128 MB
maximum_object_size 10 MB
cache_dir ufs /var/spool/squid 512 16 256
coredump_dir /var/spool/squid

# Tiles typically don't change frequently, so cache them longer
refresh_pattern ^https?://tiles\.stadiamaps\.com/.*\.(png|jpg|jpeg|gif) 10080 90% 43200 override-expire ignore-no-cache ignore-no-store

# Default refresh pattern
refresh_pattern .             0       20%     4320

# Finally, allow access to Squid from our Docker network
http_access allow all